{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "ScriptPulse Scene Boundaries Schema",
    "description": "Scene segmentation output with conservative boundary detection",
    "version": "1.0.0",
    "definitions": {
        "scene": {
            "type": "object",
            "required": [
                "scene_index",
                "start_line",
                "end_line",
                "boundary_confidence"
            ],
            "properties": {
                "scene_index": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Sequential scene number (1-indexed)"
                },
                "start_line": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "First line of scene (1-indexed)"
                },
                "end_line": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Last line of scene (1-indexed, inclusive)"
                },
                "boundary_confidence": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Confidence score for scene boundary (internal use only)"
                }
            }
        }
    },
    "type": "object",
    "required": [
        "scenes"
    ],
    "properties": {
        "scenes": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/scene"
            },
            "minItems": 1,
            "description": "Array of scene boundaries"
        }
    },
    "confidence_levels": {
        "very_high": {
            "range": [
                0.9,
                1.0
            ],
            "description": "Clear boundary with stable structural pattern",
            "indicators": [
                "Well-formed S tag",
                "Typical surrounding tags (A, C, D)",
                "No formatting noise"
            ]
        },
        "high": {
            "range": [
                0.7,
                0.89
            ],
            "description": "Strong boundary with minor irregularity",
            "indicators": [
                "S tag present",
                "Mostly stable pattern",
                "Minimal noise"
            ]
        },
        "medium": {
            "range": [
                0.5,
                0.69
            ],
            "description": "Reasonable boundary but some ambiguity",
            "indicators": [
                "S tag in unusual context",
                "Some pattern instability",
                "Moderate noise"
            ]
        },
        "low": {
            "range": [
                0.3,
                0.49
            ],
            "description": "Weak boundary, likely to be merged",
            "indicators": [
                "Isolated S tag",
                "Surrounded by metadata or noise",
                "Pattern breaks"
            ]
        },
        "very_low": {
            "range": [
                0.0,
                0.29
            ],
            "description": "Very weak signal, should be merged",
            "indicators": [
                "Multiple consecutive S tags (formatting error)",
                "Extreme noise",
                "Micro-scene length"
            ]
        }
    },
    "segmentation_constraints": {
        "conservative_principle": "When uncertain, prefer MERGING over SPLITTING",
        "minimum_scene_length": 3,
        "merge_confidence_threshold": 0.6,
        "coverage_requirement": "Every line must belong to exactly one scene",
        "no_overlaps": "Scenes cannot overlap",
        "no_gaps": "All lines must be covered"
    },
    "boundary_indicators": {
        "strong": [
            "S tag with stable surrounding pattern",
            "Clear tag sequence: ...A S A C D...",
            "Well-formed scene heading structure"
        ],
        "weak": [
            "Isolated S tag",
            "Multiple consecutive S tags",
            "S tag surrounded by metadata (M)",
            "Unusual tag transitions"
        ],
        "not_boundaries": [
            "M tags (transitions are metadata, not guaranteed boundaries)",
            "Tag changes alone (D→A, C→M)",
            "Empty lines",
            "Pattern breaks without S tag"
        ]
    },
    "forbidden_techniques": [
        "Time shift inference",
        "Location change inference from content",
        "Narrative structure analysis",
        "Semantic content analysis",
        "Industry norm enforcement",
        "Confidence inflation",
        "Treating transitions as guaranteed boundaries"
    ],
    "allowed_techniques": [
        "Structural tag pattern analysis",
        "Positional context examination",
        "Tag sequence stability assessment",
        "Format cue detection"
    ],
    "validation_rules": {
        "coverage": "All lines must be in exactly one scene",
        "sequential_indexing": "scene_index must be 1, 2, 3, ...",
        "valid_ranges": "start_line ≤ end_line",
        "minimum_length": "Scenes should be ≥ 3 lines",
        "valid_confidence": "0.0 ≤ boundary_confidence ≤ 1.0",
        "conservative_segmentation": "Prefer fewer scenes over more when uncertain"
    },
    "merge_heuristics": {
        "micro_scene_merge": {
            "description": "Merge scenes shorter than minimum length",
            "threshold": "< 3 lines",
            "action": "Merge with adjacent scene"
        },
        "low_confidence_merge": {
            "description": "Merge adjacent scenes with low boundary confidence",
            "threshold": "< 0.6 confidence",
            "action": "Combine into single scene"
        },
        "post_segmentation": {
            "description": "Final smoothing pass to reduce fragmentation",
            "action": "Review and merge remaining low-confidence boundaries"
        }
    }
}